<Window x:Class="MyMp3Player.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:MyMp3Player.Converters"
        xmlns:local="clr-namespace:MyMp3Player"
        xmlns:System="clr-namespace:System;assembly=System.Runtime"
        Title="My MP3 Player" 
        Height="600" 
        Width="1000"

>
    
    <Window.Resources>
        

        <converters:SliderValueToWidthConverter x:Key="SliderWidthConverter"/>
        <converters:SliderValueToPositionConverter x:Key="SliderPositionConverter"/>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibility"/> 
        <converters:DurationConverter x:Key="DurationConverter"/>
        <converters:ProgressConverter x:Key="ProgressConverter"/>
        <converters:MathConverter x:Key="MathConverter"/>
        <converters:VolumeToIconConverter x:Key="VolumeConverter"/>
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        
        <SolidColorBrush x:Key="ThumbBorder" Color="#666666"/>
        <SolidColorBrush x:Key="ThumbFill" Color="#444444"/>
        <SolidColorBrush x:Key="ProgressBrush" Color="#4D4DFF"/>
        <SolidColorBrush x:Key="ThumbColor" Color="#FFFFFF"/>
        
        <!-- Стиль для музыкальных частиц -->
        <Style x:Key="MusicParticle" TargetType="Ellipse">
            <Setter Property="Width" Value="4"/>
            <Setter Property="Height" Value="4"/>
            <Setter Property="Opacity" Value="0.7"/>
            <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
            <Setter Property="Fill">
                <Setter.Value>
                    <RadialGradientBrush>
                        <GradientStop Color="#3F1DB954" Offset="0"/>
                        <GradientStop Color="#001DB954" Offset="1"/>
                    </RadialGradientBrush>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Градиентный фон для окна -->
        <LinearGradientBrush x:Key="BackgroundGradient" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#121212" Offset="0"/>
            <GradientStop Color="#1E1E2A" Offset="1"/>
        </LinearGradientBrush>
        
        <!-- Градиент для акцентного цвета -->
        <LinearGradientBrush x:Key="AccentGradient" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#1DB954" Offset="0"/>
            <GradientStop Color="#1ED760" Offset="1"/>
        </LinearGradientBrush>
        
        <!-- Стиль для кнопок с индикацией активного состояния -->
        <Style x:Key="ToggleControlButton" TargetType="Button" BasedOn="{StaticResource ControlButton}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource Self}, Path=Tag}" Value="True">
                    <Setter Property="Background" Value="#1DB954"/>
                    <Setter Property="BorderBrush" Value="#1DB954"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        
        <!-- Новый стиль для элементов списка с современным дизайном -->
<Style TargetType="{x:Type ListViewItem}" x:Key="ModernPlaylistItemStyle">
    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
    <Setter Property="Cursor" Value="Hand"/>
    <Setter Property="Padding" Value="12,8"/>
    <Setter Property="Margin" Value="4,2"/>
    <Setter Property="Template">
        <Setter.Value>
            <ControlTemplate TargetType="ListViewItem">
                <Border x:Name="Container" 
                        CornerRadius="6"
                        Background="Transparent"
                        Margin="{TemplateBinding Margin}">
                    <Grid>
                        <!-- Фон элемента -->
                        <Border x:Name="BackgroundLayer" 
                                CornerRadius="6"
                                Opacity="0.6">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                    <GradientStop Color="#252530" Offset="0"/>
                                    <GradientStop Color="#1E1E28" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                        </Border>
                        
                        <!-- Эффект свечения при выделении -->
                        <Border x:Name="GlowEffect" 
                                CornerRadius="6"
                                Opacity="0"
                                Background="#1DB95420"/>
                        
                        <!-- Индикатор воспроизведения (анимированные полоски) -->
                        <Grid x:Name="PlayingIndicator" 
                              HorizontalAlignment="Left" 
                              VerticalAlignment="Center"
                              Margin="10,0,0,0"
                              Visibility="Collapsed"
                              Width="16" Height="16">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
    
                            <!-- Определяем стили для полосок с анимацией -->
                            <Grid.Resources>
                                <Style x:Key="AnimatedBarStyle" TargetType="Rectangle">
                                    <Setter Property="Fill" Value="#1DB954"/>
                                    <Setter Property="Width" Value="3"/>
                                    <Setter Property="Margin" Value="1,0"/>
                                    <Setter Property="VerticalAlignment" Value="Bottom"/>
                                </Style>
                            </Grid.Resources>
    
                            <!-- Используем стили и запускаем анимацию через код -->
                            <Rectangle x:Name="Bar1" Grid.Column="0" Style="{StaticResource AnimatedBarStyle}" Height="8"/>
                            <Rectangle x:Name="Bar2" Grid.Column="1" Style="{StaticResource AnimatedBarStyle}" Height="12"/>
                            <Rectangle x:Name="Bar3" Grid.Column="2" Style="{StaticResource AnimatedBarStyle}" Height="6"/>
                        </Grid>
                        
                        <!-- Контент -->
                        <ContentPresenter Margin="10,0,0,0"/>
                        
                        <!-- Кнопки действий (появляются при наведении) -->
                        <StackPanel x:Name="ActionButtons" 
            Orientation="Horizontal" 
            HorizontalAlignment="Right" 
            VerticalAlignment="Center"
            Margin="0,0,10,0"
            Opacity="0">
    <Button Foreground="White" 
            Background="#33333333" 
            BorderThickness="0"
            Width="30" Height="30"
            Margin="4,0"
            Cursor="Hand">
        <Button.Template>
            <ControlTemplate TargetType="Button">
                <Border Background="{TemplateBinding Background}" 
                        CornerRadius="15">
                    <Viewbox Width="16" Height="16">
                        <Path Data="M12.1,18.55L12,18.65L11.89,18.55C7.14,14.24 4,11.39 4,8.5C4,6.5 5.5,5 7.5,5C9.04,5 10.54,6 11.07,7.36H12.93C13.46,6 14.96,5 16.5,5C18.5,5 20,6.5 20,8.5C20,11.39 16.86,14.24 12.1,18.55M16.5,3C14.76,3 13.09,3.81 12,5.08C10.91,3.81 9.24,3 7.5,3C3.42,3 0,6.42 0,10.5C0,15.5 5,20 12,22C19,20 24,15.5 24,10.5C24,6.42 20.58,3 16.5,3Z" 
                              Fill="White" 
                              Stretch="Uniform"/>
                    </Viewbox>
                </Border>
            </ControlTemplate>
        </Button.Template>
    </Button>
    <Button Foreground="White" 
            Background="#33333333" 
            BorderThickness="0"
            Width="30" Height="30"
            Margin="4,0"
            Cursor="Hand">
        <Button.Template>
            <ControlTemplate TargetType="Button">
                <Border Background="{TemplateBinding Background}" 
                        CornerRadius="15">
                    <Viewbox Width="16" Height="16">
                        <Path Data="M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z" 
                              Fill="White" 
                              Stretch="Uniform"/>
                    </Viewbox>
                </Border>
            </ControlTemplate>
        </Button.Template>
    </Button>
</StackPanel>
                    </Grid>
                </Border>
                
                <ControlTemplate.Triggers>
                    <!-- Анимация при наведении -->
                    <Trigger Property="IsMouseOver" Value="True">
                        <Trigger.EnterActions>
                            <BeginStoryboard>
                                <Storyboard>
                                    <DoubleAnimation Storyboard.TargetName="GlowEffect" 
                                                     Storyboard.TargetProperty="Opacity"
                                                     To="0.4" 
                                                     Duration="0:0:0.2"/>
                                    <DoubleAnimation Storyboard.TargetName="ActionButtons" 
                                                     Storyboard.TargetProperty="Opacity"
                                                     To="1" 
                                                     Duration="0:0:0.2"/>
                                    <ColorAnimation Storyboard.TargetName="BackgroundLayer" 
                                                    Storyboard.TargetProperty="(Border.Background).(GradientBrush.GradientStops)[0].Color"
                                                    To="#2A2A38" 
                                                    Duration="0:0:0.2"/>
                                </Storyboard>
                            </BeginStoryboard>
                        </Trigger.EnterActions>
                        <Trigger.ExitActions>
                            <BeginStoryboard>
                                <Storyboard>
                                    <DoubleAnimation Storyboard.TargetName="GlowEffect" 
                                                     Storyboard.TargetProperty="Opacity"
                                                     To="0" 
                                                     Duration="0:0:0.3"/>
                                    <DoubleAnimation Storyboard.TargetName="ActionButtons" 
                                                     Storyboard.TargetProperty="Opacity"
                                                     To="0" 
                                                     Duration="0:0:0.3"/>
                                    <ColorAnimation Storyboard.TargetName="BackgroundLayer" 
                                                    Storyboard.TargetProperty="(Border.Background).(GradientBrush.GradientStops)[0].Color"
                                                    To="#252530" 
                                                    Duration="0:0:0.3"/>
                                </Storyboard>
                            </BeginStoryboard>
                        </Trigger.ExitActions>
                    </Trigger>

                    <!-- Стиль для выбранного элемента -->
                    <Trigger Property="IsSelected" Value="True">
                        <Setter Property="Foreground" Value="White"/>
                        <Setter TargetName="GlowEffect" Property="Opacity" Value="0.5"/>
                        <Setter TargetName="BackgroundLayer" Property="Background">
                            <Setter.Value>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                    <GradientStop Color="#1DB954" Offset="0"/>
                                    <GradientStop Color="#1A9E48" Offset="1"/>
                                </LinearGradientBrush>
                            </Setter.Value>
                        </Setter>
                        <Setter TargetName="PlayingIndicator" Property="Visibility" Value="Visible"/>
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>
        </Setter.Value>
    </Setter>
</Style>
        
        <!-- Новый стиль для списка треков -->
<Style TargetType="{x:Type ListView}" x:Key="ModernPlaylistStyle">
    <Setter Property="Background" Value="Transparent"/>
    <Setter Property="BorderThickness" Value="0"/>
    <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled"/>
    <Setter Property="ItemContainerStyle" Value="{StaticResource ModernPlaylistItemStyle}"/>
    <Setter Property="Template">
        <Setter.Value>
            <ControlTemplate TargetType="ListView">
                <Border CornerRadius="12" 
                        Background="#1A1A22" 
                        BorderBrush="#333344"
                        BorderThickness="1"
                        Margin="15"
                        Padding="5">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <!-- Заголовок плейлиста -->
                        <Border Grid.Row="0" 
                                Background="#252530"
                                CornerRadius="8"
                                Margin="5,5,5,10"
                                Padding="15,12">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Column="0" 
                                           Text="Playlist" 
                                           FontSize="18" 
                                           FontWeight="SemiBold" 
                                           Foreground="White"/>
                                
                                <TextBlock Grid.Column="1" 
                                           Text="{Binding Playlist.Count, StringFormat='{}{0} tracks'}" 
                                           Foreground="#A0A0A0"
                                           FontSize="14"
                                           VerticalAlignment="Center"
                                           HorizontalAlignment="Right"
                                           Margin="0,0,15,0"/>
                                
                                <Button Grid.Column="2" 
        Command="{Binding AddTrackCommand}"
        Foreground="White"
        Background="#1DB954"
        Width="28" Height="28"
        ToolTip="Add tracks">
    <Button.Template>
        <ControlTemplate TargetType="Button">
            <Border Background="{TemplateBinding Background}" 
                    CornerRadius="14">
                <ContentControl>
                    <Viewbox Width="16" Height="16">
                        <ContentControl Content="{StaticResource AddIcon}"/>
                    </Viewbox>
                </ContentControl>
            </Border>
        </ControlTemplate>
    </Button.Template>
</Button>
                            </Grid>
                        </Border>
                        
                        <!-- Список треков -->
                        <ScrollViewer Grid.Row="1" 
                                      VerticalScrollBarVisibility="Auto"
                                      HorizontalScrollBarVisibility="Disabled">
                            <ItemsPresenter/>
                        </ScrollViewer>
                        
                        <!-- Кастомный скроллбар -->
                        <ScrollBar Grid.Row="1" 
                                   HorizontalAlignment="Right" 
                                   Width="8"
                                   Margin="0,0,2,0"
                                   Background="Transparent"
                                   BorderThickness="0">
                            <ScrollBar.Style>
                                <Style TargetType="ScrollBar">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="ScrollBar">
                                                <Grid>
                                                    <Rectangle Width="6" 
                                                               Fill="#2A2A38" 
                                                               RadiusX="3" 
                                                               RadiusY="3"/>
                                                    <Thumb Width="6" 
                                                           Background="#4D4D60">
                                                        <Thumb.Template>
                                                            <ControlTemplate TargetType="Thumb">
                                                                <Rectangle Fill="#4D4D60" 
                                                                           RadiusX="3" 
                                                                           RadiusY="3"/>
                                                            </ControlTemplate>
                                                        </Thumb.Template>
                                                    </Thumb>
                                                </Grid>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </ScrollBar.Style>
                        </ScrollBar>
                    </Grid>
                </Border>
            </ControlTemplate>
        </Setter.Value>
    </Setter>
    
    <!-- Шаблон для элементов списка -->
    <Setter Property="ItemTemplate">
        <Setter.Value>
            <DataTemplate>
                <Grid Height="50">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="150"/>
                        <ColumnDefinition Width="80"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Название трека -->
                    <TextBlock Grid.Column="0" 
                               Text="{Binding Title}" 
                               Foreground="White"
                               FontSize="14"
                               FontWeight="Medium"
                               VerticalAlignment="Center"
                               TextTrimming="CharacterEllipsis"
                               Margin="10,0,0,0"/>
                    
                    <!-- Исполнитель -->
                    <TextBlock Grid.Column="1" 
                               Text="{Binding Artist}" 
                               Foreground="#B0B0B0"
                               FontSize="14"
                               VerticalAlignment="Center"
                               TextTrimming="CharacterEllipsis"/>
                    
                    <!-- Длительность -->
                    <TextBlock Grid.Column="2" 
                               Text="{Binding Duration}" 
                               Foreground="#B0B0B0"
                               FontSize="14"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Center"/>
                </Grid>
            </DataTemplate>
        </Setter.Value>
    </Setter>
</Style>
        
        <Style x:Key="SliderRepeatButtonStyle" TargetType="RepeatButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RepeatButton">
                        <Border Background="{TemplateBinding Background}"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <Style x:Key="SliderThumbStyle" TargetType="Thumb">
            <Setter Property="Width" Value="14"/>
            <Setter Property="Height" Value="14"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Thumb">
                        <Grid>
                            <Ellipse x:Name="ThumbCircle"
                                     Fill="#1DB954"
                                     Stroke="#0F8030"
                                     StrokeThickness="1"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>


        
        

        <!-- Стиль для обычных кнопок управления -->
        <Style x:Key="ControlButton" TargetType="Button">
    <Setter Property="Background" Value="Transparent"/>
    <Setter Property="BorderThickness" Value="0"/>
    <Setter Property="Foreground" Value="#A0A0A0"/>
    <Setter Property="FontSize" Value="20"/>
    <Setter Property="Padding" Value="12"/>
    <Setter Property="Cursor" Value="Hand"/>
    <Setter Property="Width" Value="40"/>
    <Setter Property="Height" Value="40"/>
    <Setter Property="Template">
        <Setter.Value>
            <ControlTemplate TargetType="Button">
                <Border x:Name="ButtonBorder" 
                        Background="#2A2A36" 
                        CornerRadius="20"
                        BorderThickness="0"
                        Opacity="0.7">
                    <ContentPresenter HorizontalAlignment="Center" 
                                      VerticalAlignment="Center"/>
                    <Border.Effect>
                        <DropShadowEffect Color="#000000" BlurRadius="5" ShadowDepth="1" Opacity="0.3"/>
                    </Border.Effect>
                </Border>
                <ControlTemplate.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter TargetName="ButtonBorder" Property="Background" Value="#3A3A46"/>
                        <Setter TargetName="ButtonBorder" Property="Opacity" Value="1"/>
                        <Setter TargetName="ButtonBorder" Property="Effect">
                            <Setter.Value>
                                <DropShadowEffect Color="#1DB954" BlurRadius="8" ShadowDepth="0" Opacity="0.5"/>
                            </Setter.Value>
                        </Setter>
                    </Trigger>
                    <Trigger Property="IsPressed" Value="True">
                        <Setter TargetName="ButtonBorder" Property="Background" Value="#1DB954"/>
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>
        </Setter.Value>
    </Setter>
    <Style.Triggers>
        <Trigger Property="IsMouseOver" Value="True">
            <Setter Property="Foreground" Value="White"/>
        </Trigger>
        <Trigger Property="IsPressed" Value="True">
            <Setter Property="Foreground" Value="White"/>
        </Trigger>
    </Style.Triggers>
</Style>

        <!-- Стиль для главной кнопки воспроизведения -->
        <Style x:Key="MainPlayerButton" TargetType="Button">
    <Setter Property="Width" Value="56"/>
    <Setter Property="Height" Value="56"/>
    <Setter Property="Background" Value="{StaticResource AccentGradient}"/>
    <Setter Property="Foreground" Value="White"/>
    <Setter Property="FontSize" Value="22"/>
    <Setter Property="Cursor" Value="Hand"/>
    <Setter Property="Template">
        <Setter.Value>
            <ControlTemplate TargetType="Button">
                <Border x:Name="ButtonBorder" 
                        Background="{TemplateBinding Background}" 
                        CornerRadius="28"
                        BorderThickness="0">
                    <ContentPresenter HorizontalAlignment="Center" 
                                      VerticalAlignment="Center"/>
                    <Border.Effect>
                        <DropShadowEffect Color="#1DB954" BlurRadius="10" ShadowDepth="0" Opacity="0.7"/>
                    </Border.Effect>
                </Border>
                <ControlTemplate.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter TargetName="ButtonBorder" Property="Effect">
                            <Setter.Value>
                                <DropShadowEffect Color="#1DB954" BlurRadius="15" ShadowDepth="0" Opacity="1"/>
                            </Setter.Value>
                        </Setter>
                        <Setter TargetName="ButtonBorder" Property="Background">
                            <Setter.Value>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#22DD65" Offset="0"/>
                                    <GradientStop Color="#1DB954" Offset="1"/>
                                </LinearGradientBrush>
                            </Setter.Value>
                        </Setter>
                    </Trigger>
                    <Trigger Property="IsPressed" Value="True">
                        <Setter TargetName="ButtonBorder" Property="Background">
                            <Setter.Value>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#1AA548" Offset="0"/>
                                    <GradientStop Color="#19A045" Offset="1"/>
                                </LinearGradientBrush>
                            </Setter.Value>
                        </Setter>
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>
        </Setter.Value>
    </Setter>
</Style>
        
        
        
        <!-- Стиль для слайдера прогресса -->
        <Style x:Key="ProgressSliderStyle" TargetType="Slider">
            <Setter Property="IsMoveToPointEnabled" Value="True"/>
            <Setter Property="IsSnapToTickEnabled" Value="False"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Slider">
                        <Grid>
                            <!-- Фоновая дорожка -->
                            <Border x:Name="TrackBackground"
                                    Height="4"
                                    Background="#404040"
                                    CornerRadius="2"/>
                    
                            <!-- Активный прогресс -->
                            <Border x:Name="ProgressBar"
                                    Height="4"
                                    Background="#1DB954"
                                    HorizontalAlignment="Left"
                                    CornerRadius="2"
                                    Width="{Binding Value, 
                                    RelativeSource={RelativeSource TemplatedParent},
                                    Converter={StaticResource ProgressConverter}}"/>
                    
                            <!-- Ползунок и трек -->
                            <Track x:Name="PART_Track">
                                <Track.Thumb>
                                    <Thumb Style="{StaticResource SliderThumbStyle}"/>
                                </Track.Thumb>
                            </Track>
                            
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Стиль для слайдера громкости -->
        <Style x:Key="VolumeSliderStyle" TargetType="Slider">
            <Setter Property="Minimum" Value="0"/>
            <Setter Property="Maximum" Value="1"/>
            <Setter Property="IsMoveToPointEnabled" Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Slider">
                        <Grid>
                            <!-- Фоновая дорожка -->
                            <Border x:Name="TrackBackground"
                                    Height="4"
                                    Background="#404040"
                                    CornerRadius="2"/>
                    
                            <!-- Активный прогресс -->
                            <Border x:Name="ProgressBar"
                                    Height="4"
                                    Background="#1DB954"
                                    HorizontalAlignment="Left"
                                    CornerRadius="2"
                                    Width="{Binding Value, 
                                    RelativeSource={RelativeSource TemplatedParent},
                                    Converter={StaticResource MathConverter},
                                    ConverterParameter=100}"/>
                    
                            <!-- Ползунок -->
                            <Track x:Name="PART_Track">
                                <Track.Thumb>
                                    <Thumb Style="{StaticResource SliderThumbStyle}"/>
                                </Track.Thumb>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        

        
        <!-- Стиль для заголовков колонок -->
        <Style TargetType="{x:Type GridViewColumnHeader}">
            <Setter Property="Background" Value="#1A1A1A"/>
            <Setter Property="Foreground" Value="#A0A0A0"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="GridViewColumnHeader">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="8,8,0,0"
                                Padding="10">
                            <ContentPresenter HorizontalAlignment="Left"
                                              VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Эффект свечения для кнопок -->
        <DropShadowEffect x:Key="GlowEffect" 
                          Color="#1DB954" 
                          BlurRadius="10" 
                          ShadowDepth="0" 
                          Opacity="0.7"/>
        
        
    </Window.Resources>
    
    <!-- Основной градиентный фон -->
    <Window.Background>
        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#121212" Offset="0"/>
            <GradientStop Color="#1E1E2A" Offset="1"/>
        </LinearGradientBrush>
    </Window.Background>

    <Grid>
        
        
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Верхняя панель с названием и поиском -->
        <Grid Grid.Row="0" Background="#1A1A1A" Height="60">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <TextBlock Grid.Column="0" 
                       Text="kes1red PLAYER" 
                       FontSize="22" 
                       FontWeight="Bold" 
                       Foreground="White" 
                       VerticalAlignment="Center" 
                       Margin="20,0,0,0">
                <TextBlock.Effect>
                    <DropShadowEffect Color="#1DB954" BlurRadius="5" ShadowDepth="0"/>
                </TextBlock.Effect>
            </TextBlock>
            
            <Border Grid.Column="1" 
                    Width="300" 
                    Height="36" 
                    Background="#252525" 
                    CornerRadius="18" 
                    HorizontalAlignment="Center" 
                    VerticalAlignment="Center">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" 
                               Text="🔍" 
                               FontSize="16" 
                               Foreground="#808080" 
                               VerticalAlignment="Center" 
                               Margin="15,0,5,0"/>
                    <TextBox Grid.Column="1" 
                             Background="Transparent" 
                             BorderThickness="0" 
                             Foreground="#A0A0A0" 
                             VerticalAlignment="Center" 
                             FontSize="14" 
                             Margin="0,0,10,0" 
                             Text="Поиск..."/>
                </Grid>
            </Border>
            
            <StackPanel Grid.Column="2" 
                        Orientation="Horizontal" 
                        VerticalAlignment="Center" 
                        Margin="0,0,20,0">
                <Button Grid.Column="2" 
                        Command="{Binding AddTrackCommand}"
                        Foreground="White"
                        Background="#1DB954"
                        Width="28" Height="28"
                        ToolTip="Добавить треки">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border Background="{TemplateBinding Background}" 
                                    CornerRadius="14">
                                <Viewbox Width="16" Height="16">
                                    <Path Data="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z" 
                                          Fill="White" 
                                          Stretch="Uniform"/>
                                </Viewbox>
                            </Border>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
                <Button Style="{StaticResource ControlButton}" 
                        ToolTip="Настройки">
                    <ContentControl>
                        <Viewbox Width="18" Height="18">
                            <ContentControl Content="{StaticResource SettingsIcon}"/>
                        </Viewbox>
                    </ContentControl>
                </Button>
            </StackPanel>
        </Grid>

        <!-- Список песен с улучшенным дизайном -->
        <ListView x:Name="PlaylistView"
                  Grid.Row="1"
                  ItemsSource="{Binding Playlist}"
                  SelectedItem="{Binding CurrentSong}"
                  Style="{StaticResource ModernPlaylistStyle}"
                  HorizontalContentAlignment="Stretch"
                  Margin="10">
    
            
        </ListView>
        
        

        <!-- Нижняя панель управления плеером с улучшенным дизайном -->
<Border Grid.Row="2" 
        Background="#202028" 
        Height="100"
        CornerRadius="15,15,0,0"
        Effect="{StaticResource GlowEffect}">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="300"/> <!-- Левая часть -->
            <ColumnDefinition Width="*"/> <!-- Центральные контролы -->
            <ColumnDefinition Width="200"/> <!-- Правая часть -->
        </Grid.ColumnDefinitions>

        <!-- Информация о текущем треке с обложкой -->
<Grid Grid.Column="0" Margin="20,0,0,0">
    <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto"/>
        <ColumnDefinition Width="*"/>
    </Grid.ColumnDefinitions>
    
    <!-- Обложка альбома -->
    <Border Grid.Column="0" 
            Width="60" 
            Height="60" 
            Background="#2A2A35" 
            CornerRadius="10"
            VerticalAlignment="Center">
        <TextBlock Text="🎵" 
                   FontSize="24" 
                   HorizontalAlignment="Center" 
                   VerticalAlignment="Center"/>
    </Border>
    
    <!-- Название и исполнитель -->
    <Grid Grid.Column="1" Margin="15,0,0,0">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        
        <!-- ДОБАВИТЬ ЗДЕСЬ: Индикатор воспроизведения -->
        <Grid x:Name="PlayingIndicator"
              Grid.Column="0"
              HorizontalAlignment="Left"
              VerticalAlignment="Center"
              Margin="0,0,5,0"
              Width="16" Height="16"
              Visibility="{Binding IsPlaying, Converter={StaticResource BooleanToVisibilityConverter}}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- Полоски для анимации -->
            <Rectangle x:Name="Bar1" Grid.Column="0" Fill="#1DB954" Width="3" Height="8" Margin="1,0" VerticalAlignment="Bottom"/>
            <Rectangle x:Name="Bar2" Grid.Column="1" Fill="#1DB954" Width="3" Height="12" Margin="1,0" VerticalAlignment="Bottom"/>
            <Rectangle x:Name="Bar3" Grid.Column="2" Fill="#1DB954" Width="3" Height="6" Margin="1,0" VerticalAlignment="Bottom"/>
        </Grid>
        
        <!-- Информация о треке -->
        <StackPanel Grid.Column="1" VerticalAlignment="Center">
            <TextBlock x:Name="CurrentSongTitleText"
                       Text="{Binding CurrentSongTitle}"
                       Foreground="White"
                       FontSize="16"
                       FontWeight="SemiBold"
                       TextTrimming="CharacterEllipsis"/>
            <TextBlock x:Name="CurrentArtistText"
                       Text="{Binding CurrentArtist}"
                       Foreground="#A0A0A0"
                       FontSize="14"
                       TextTrimming="CharacterEllipsis"
                       Margin="0,4,0,0"/>
        </StackPanel>
    </Grid>
    
</Grid>

        <!-- Центральная панель с элементами управления -->
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <!-- Кнопки управления воспроизведением -->

<StackPanel Grid.Row="0" 
            Orientation="Horizontal" 
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            Margin="0,10,0,5">
    <!-- Кнопка повтора -->
    <Button x:Name="RepeatButton" 
            Style="{StaticResource ControlButton}"
            Command="{Binding ToggleRepeatCommand}"
            Margin="5,0">
        <Viewbox Width="18" Height="18">
            <ContentControl Content="{StaticResource RepeatIcon}"/>
        </Viewbox>
    </Button>
    
    <!-- Кнопка предыдущего трека -->
    <Button x:Name="PrevButton" 
            Command="{Binding PreviousCommand}"
            Style="{StaticResource ControlButton}" 
            Margin="5,0">
        <Viewbox Width="18" Height="18">
            <ContentControl Content="{StaticResource PreviousIcon}"/>
        </Viewbox>
    </Button>
    
    <!-- Кнопка воспроизведения/паузы -->
    <Button x:Name="PlayButton" 
            Command="{Binding PlayPauseCommand}"
            Style="{StaticResource MainPlayerButton}"
            Margin="10,0">
        <Viewbox Width="24" Height="24">
            <ContentControl>
                <ContentControl.Style>
                    <Style TargetType="ContentControl">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsPlaying}" Value="True">
                                <Setter Property="Content" Value="{StaticResource PauseIcon}"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding IsPlaying}" Value="False">
                                <Setter Property="Content" Value="{StaticResource PlayIcon}"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ContentControl.Style>
            </ContentControl>
        </Viewbox>
    </Button>
    
    <!-- Кнопка следующего трека -->
    <Button x:Name="NextButton" 
            Command="{Binding NextCommand}"
            Style="{StaticResource ControlButton}"
            Margin="5,0">
        <Viewbox Width="18" Height="18">
            <ContentControl Content="{StaticResource NextIcon}"/>
        </Viewbox>
    </Button>
    
    <!-- Кнопка перемешивания -->
    <Button x:Name="ShuffleButton" 
            Style="{StaticResource ControlButton}"
            Margin="5,0"
            Command="{Binding ToggleShuffleCommand}"
            >
        
        <Viewbox Width="18" Height="18">
            <ContentControl Content="{StaticResource ShuffleIcon}"/>
        </Viewbox>
    </Button>
</StackPanel>

            <!-- Слайдер прогресса -->
            <Grid Grid.Row="1" 
                  Width="400" 
                  HorizontalAlignment="Center"
                  Margin="0,5,0,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
    
                <TextBlock Grid.Column="0" 
                           x:Name="CurrentTimeText" 
                           Text="{Binding CurrentTime}"
                           Foreground="White" 
                           FontSize="12"
                           VerticalAlignment="Center"
                           Margin="0,0,10,0"/>
    
                <Slider Grid.Column="1"
                        x:Name="ProgressSlider"
                        Minimum="0" 
                        Maximum="{Binding TotalDuration}"
                        Value="{Binding CurrentPosition, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                        Style="{StaticResource ProgressSliderStyle}"
                        Thumb.DragStarted="ProgressSlider_DragStarted"
                        Thumb.DragCompleted="ProgressSlider_DragCompleted"/>
    
                <TextBlock Grid.Column="2" 
                           x:Name="TotalTimeText" 
                           Text="{Binding TotalTime}"
                           Foreground="#A0A0A0" 
                           FontSize="12"
                           VerticalAlignment="Center"
                           Margin="10,0,0,0"/>
            </Grid>
        </Grid>

        <!-- Управление громкостью (справа) -->
        <StackPanel Grid.Column="2" 
                    Orientation="Horizontal"
                    VerticalAlignment="Center"
                    HorizontalAlignment="Right"
                    Margin="0,0,20,0">
            <Button x:Name="VolumeButton"
        Command="{Binding ToggleMuteCommand}"
        Style="{StaticResource ControlButton}"
        Margin="5,0">
    <Viewbox Width="20" Height="20">
        <ContentControl>
            <ContentControl.Style>
                <Style TargetType="ContentControl">
                    <Setter Property="Content" Value="{StaticResource VolumeMuteIcon}"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsMuted}" Value="True">
                            <Setter Property="Content" Value="{StaticResource VolumeMuteIcon}"/>
                        </DataTrigger>
                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding IsMuted}" Value="False"/>
                                <Condition Binding="{Binding Volume}" Value="0"/>
                            </MultiDataTrigger.Conditions>
                            <Setter Property="Content" Value="{StaticResource VolumeMuteIcon}"/>
                        </MultiDataTrigger>
                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding IsMuted}" Value="False"/>
                                <Condition Binding="{Binding Volume, Converter={StaticResource MathConverter}, ConverterParameter='Between:0:0.3'}" Value="True"/>
                            </MultiDataTrigger.Conditions>
                            <Setter Property="Content" Value="{StaticResource VolumeLowIcon}"/>
                        </MultiDataTrigger>
                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding IsMuted}" Value="False"/>
                                <Condition Binding="{Binding Volume, Converter={StaticResource MathConverter}, ConverterParameter='Between:0.3:0.7'}" Value="True"/>
                            </MultiDataTrigger.Conditions>
                            <Setter Property="Content" Value="{StaticResource VolumeMediumIcon}"/>
                        </MultiDataTrigger>
                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding IsMuted}" Value="False"/>
                                <Condition Binding="{Binding Volume, Converter={StaticResource MathConverter}, ConverterParameter='GreaterThanOrEqual:0.7'}" Value="True"/>
                            </MultiDataTrigger.Conditions>
                            <Setter Property="Content" Value="{StaticResource VolumeHighIcon}"/>
                        </MultiDataTrigger>
                    </Style.Triggers>
                </Style>
            </ContentControl.Style>
        </ContentControl>
    </Viewbox>
</Button>

            <Slider x:Name="VolumeSlider" 
                    Value="{Binding Volume, Mode=TwoWay}" 
                    Minimum="0"
                    Maximum="1"
                    Width="100"
                    VerticalAlignment="Center"
                    Style="{StaticResource VolumeSliderStyle}"
                    Margin="0,0,10,0"/>
        </StackPanel>
    </Grid>
</Border>
        <!-- Исправленный Canvas для частиц -->
        <Canvas x:Name="ParticlesCanvas" 
                Grid.Row="0" 
                Grid.RowSpan="3" 
                Panel.ZIndex="0"
                Background="Transparent"
                IsHitTestVisible="False"/>
    </Grid>
</Window>